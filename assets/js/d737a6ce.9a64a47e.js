"use strict";(self.webpackChunk_minimajs_docs=self.webpackChunk_minimajs_docs||[]).push([[3099],{9127:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var t=s(86),r=s(6491);const a={title:"Http Helpers",sidebar_position:4,tags:["request","response","error","context","hooks"]},i=void 0,l={id:"Guide/http",title:"Http Helpers",description:"The request/response are globally accessible anywhere from request contexts.",source:"@site/docs/Guide/http.md",sourceDirName:"Guide",slug:"/Guide/http",permalink:"/Guide/http",draft:!1,unlisted:!1,tags:[{label:"request",permalink:"/tags/request"},{label:"response",permalink:"/tags/response"},{label:"error",permalink:"/tags/error"},{label:"context",permalink:"/tags/context"},{label:"hooks",permalink:"/tags/hooks"}],version:"current",sidebarPosition:4,frontMatter:{title:"Http Helpers",sidebar_position:4,tags:["request","response","error","context","hooks"]},sidebar:"defaultSidebar",previous:{title:"Routing",permalink:"/Guide/routing"},next:{title:"Logging",permalink:"/Guide/logger"}},o={},c=[{value:"Request",id:"request",level:2},{value:"getRequest",id:"getrequest",level:3},{value:"getHeaders",id:"getheaders",level:3},{value:"getHeader",id:"getheader",level:3},{value:"getSearchParams",id:"getsearchparams",level:3},{value:"getParam",id:"getparam",level:3},{value:"getSearchParam",id:"getsearchparam",level:3},{value:"getBody",id:"getbody",level:3},{value:"Response",id:"response",level:2},{value:"Return value as response",id:"return-value-as-response",level:3},{value:"Async",id:"async",level:3},{value:"Streams",id:"streams",level:3},{value:"Generators",id:"generators",level:3},{value:"getResponse",id:"getresponse",level:3},{value:"setStatusCode",id:"setstatuscode",level:3},{value:"setHeader",id:"setheader",level:3},{value:"Hooks",id:"hooks",level:2},{value:"defer",id:"defer",level:3},{value:"Exceptions",id:"exceptions",level:2},{value:"redirect",id:"redirect",level:3},{value:"abort",id:"abort",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["The request/response are globally accessible anywhere from request contexts.\nThe following functions are exposed from ",(0,t.jsx)(n.code,{children:"@minimajs/server"})," for handling HTTP requests and responses:"]}),"\n",(0,t.jsx)(n.h2,{id:"request",children:"Request"}),"\n",(0,t.jsx)(n.h3,{id:"getrequest",children:"getRequest"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"getRequest(): Request\n"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves the HTTP request object."}),"\n",(0,t.jsx)(n.p,{children:"Examples:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { getBody, getRequest } from "@minimajs/server";\napp.get("/", () => {\n  // highlight-next-line\n  const request = getRequest();\n  return request.url;\n});\napp.post("/", () => createUser(getBody()));\n'})}),"\n",(0,t.jsx)(n.p,{children:"And even you can use request in nested function calls"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'function getURL() {\n  // highlight-next-line\n  return getRequest().url;\n}\napp.get("/", () => {\n  const url = getURL();\n  return url;\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getheaders",children:"getHeaders"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"getHeaders(): Record<string, string | string[]>\n"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves the request headers."}),"\n",(0,t.jsx)(n.h3,{id:"getheader",children:"getHeader"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"getHeader<T = string | undefined>(name: string): T\n"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves the value of a specific request header."}),"\n",(0,t.jsx)(n.h3,{id:"getsearchparams",children:"getSearchParams"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"getSearchParams<T = ParsedUrlQuery>(): T\n"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves the URL query parameters."}),"\n",(0,t.jsx)(n.h3,{id:"getparam",children:"getParam"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function getParam<T>(name: string, cast?: CastTo<T> | null, required?: boolean): T;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves and validates parameters from the current request context. It optionally casts the values to a specified type and enforces that the parameter is required."}),"\n",(0,t.jsx)(n.p,{children:"Examples"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// Basic usage\nconst paramName: string = getParam("name");\n\n// Casting to a specific type\nconst paramValue: number = getParam("age", Number);\n\n// Casting to an optional type with a specific cast function\nconst optionalParamValue: number | undefined = getParam("optional", Number, false);\n\n// Casting to an optional type with custom validation\nconst customValidationParam: string | undefined = getParam("custom", (value) => {\n  if (typeof value === "string" && value.length < 10) {\n    return value;\n  }\n  throw new Error("Invalid value");\n});\n\n// Optional param\nconst requiredParam: string | undefined = getParam("token", null, false);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getsearchparam",children:"getSearchParam"}),"\n",(0,t.jsx)(n.p,{children:"Retrieves and validates query parameters from the current request context. It optionally casts the values to a specified type or array of types and enforces that the parameter is required."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// Basic usage\nconst paramName: string | undefined = getSearchParam("name");\n\n// Casting to a specific type\nconst paramValue: number | undefined = getSearchParam("age", Number);\n\n// Casting to an array of a specific type\nconst paramValues: string[] | undefined = getSearchParam("tags", [String]);\n\n// Enforcing that the parameter is required\nconst requiredParam: string = getSearchParam("token", null, true);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getbody",children:"getBody"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"getBody<T = unknown>(): T\n"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves the request body."}),"\n",(0,t.jsx)(n.h2,{id:"response",children:"Response"}),"\n",(0,t.jsx)(n.h3,{id:"return-value-as-response",children:"Return value as response"}),"\n",(0,t.jsx)(n.p,{children:"just return the value will be a response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'app.get("/", () => {\n  return "Hello world";\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"async",children:"Async"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'app.get("/", async () => {\n  const response = await fetch("https://.../");\n  return response.json();\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"streams",children:"Streams"}),"\n",(0,t.jsx)(n.p,{children:"Any Readable streams are a valid response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { createReadStream } from "node:fs";\n\napp.get("/", async () => {\n  return createReadStream("package.json");\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"generators",children:"Generators"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { setTimeout as sleep } from "node:timers/promise";\n\nasync function* getDates() {\n  yield new Date().toString();\n  await sleep(1000);\n  yield new Date().toString();\n}\n\napp.get("/", getDates);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getresponse",children:"getResponse"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"getResponse(): Response\n"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves the HTTP response object."}),"\n",(0,t.jsx)(n.h3,{id:"setstatuscode",children:"setStatusCode"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"setStatusCode(statusCode: keyof typeof StatusCodes | number): Response\n"})}),"\n",(0,t.jsx)(n.p,{children:"Sets the HTTP status code for the response."}),"\n",(0,t.jsx)(n.h3,{id:"setheader",children:"setHeader"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"setHeader(name: string, value: string): Response\n"})}),"\n",(0,t.jsx)(n.p,{children:"Sets a response header."}),"\n",(0,t.jsx)(n.h2,{id:"hooks",children:"Hooks"}),"\n",(0,t.jsx)(n.h3,{id:"defer",children:"defer"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'function saveUser() {\n  // saving user\n  // save some log\n  // highlight-start\n  defer(() => {\n    console.log("deleting log");\n    // delete log\n    // this will executed after request context completed\n  });\n  // highlight-end\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"exceptions",children:"Exceptions"}),"\n",(0,t.jsx)(n.h3,{id:"redirect",children:"redirect"}),"\n",(0,t.jsx)(n.p,{children:"Redirects the client to the specified path."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"redirect(path: string, isPermanent?: boolean): never\n"})}),"\n",(0,t.jsx)(n.p,{children:"Throws a RedirectError to redirect the client to a specified path."}),"\n",(0,t.jsx)(n.p,{children:"Parameters:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"path"})," (string): The URL path to redirect to."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"isPermanent"})," (boolean): Optional parameter indicating whether the redirect is permanent (HTTP status code 301) or temporary (HTTP status code 302). Default is false."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Examples:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { redirect } from "@minimajs/server";\n\nasync function handleRequest() {\n  // Example 1: Redirect to a specific path\n  redirect("/home");\n\n  // Example 2: Redirect permanently to a different path\n  redirect("/new-home", true);\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"abort",children:"abort"}),"\n",(0,t.jsx)(n.p,{children:"Terminates the current operation with an optional message and HTTP status code."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"abort(response: string | Record<string, unknown>, statusCode: StatusCode): never\n"})}),"\n",(0,t.jsx)(n.p,{children:"Throws an HttpError to abort the current operation with a specified message and status code."}),"\n",(0,t.jsx)(n.p,{children:"Parameters:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"response"})," (string | Record<string, unknown>): A descriptive message explaining the reason for aborting the operation."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"statusCode"})," (StatusCode): An optional parameter indicating the HTTP status code associated with the abort."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Examples:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { abort, getParam } from "@minimajs/server";\n\nasync function findUser() {\n  const param = getParam("user");\n  const user = await User.findOne({ _id: param });\n  if (!user) {\n    // example 1: status code as number\n    // highlight-next-line\n    abort("User doesn\'t exists", 404);\n    // i won\'t be reachable\n  }\n  if (user.type !== "admin") {\n    // Example 2: Abort with a custom message and status code\n    // highlight-next-line\n    abort("Unauthorized access", "UNAUTHORIZED");\n  }\n  return user;\n}\n\napp.get("/users/:user", findUser);\n'})}),"\n",(0,t.jsxs)(n.p,{children:["These functions provide essential utilities for handling HTTP requests and responses within request context built-in ",(0,t.jsx)(n.code,{children:"@minimajs/server"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},6491:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var t=s(1654);const r={},a=t.createContext(r);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);